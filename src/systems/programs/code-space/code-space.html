<div class="program-container" [class.active]="active">
    <div class="program-header" >
        <div class="d-flex flex-row">
            <app-win-icon [programConfig]="getIcon()"></app-win-icon>
            <div class="menu-item dropdown" (click)="toggleFileMenu()" (blur)="closeFileMenu()" tabindex="0" style="position: relative;">
                File
                @if(fileMenuVisible){
                    <div class="shadow"
                         style="position: absolute; top: 100%; left: 0; background: white; border: 1px solid #ccc; z-index: 1000; min-width: 150px;">
                        <div class="dropdown-item" (click)="openFile()">打开文件</div>
                        <div class="dropdown-item" (click)="openFolder()">打开文件夹</div>
                        <div class="dropdown-item" (click)="openSetting()">设定</div>
                        <div class="dropdown-item" (click)="exit()">退出</div>
                    </div>
                }

            </div>
            <button class="menu-item">Edit</button>
            <button class="menu-item">Selection</button>
            <button class="menu-item">View</button>
            <button class="menu-item">Go</button>
            <button class="menu-item">
                <img src="assets/icons/code-space/more.svg" width="20" height="20">
            </button>
        </div>
        <div class="flex-grow-1 touch-drag" (mousedown)="startDrag($event)" (touchstart)="touchDrag($event)">

        </div>
        <div class="d-flex flex-row ">
            <button class="mini-btn" (click)="minimizeWindow()">
                <nz-icon nzType="line"
                />
            </button>
            <button class="max-btn" (click)="maximizeWindow()">
                <nz-icon nzType="border"
                />
            </button>
            <button class="close-btn " (click)="closeWindow()">
                <nz-icon nzType="close"  />
            </button>
        </div>
    </div>

    <div class="program-content code-space-content">
        <div class="d-flex flex-column stock flex-grow-0 flex-shrink-0">
            <button class="plane-button py-2" (click)="changePanelVisibleStatus()">
                <nz-icon nzType="profile" />
            </button>
        </div>
        <as-split gutterSize="2" direction="horizontal" (dragEnd)="monacoEditorViewUpdate()">
            <as-split-area [minSize]="20" size="26" [visible]="leftPanelVisible">
                <div class="w-100 flex-grow-0 flex-shrink-0">
                    @if(startFolder!==''){
                        <app-folder-root class="scroll-container" (fileSelected)="onFileOpen($event)" [baseFolder]="startFolder"></app-folder-root>
                    }
                </div>
            </as-split-area>
            <as-split-area size="74">
                <div class="d-flex flex-column w-100 h-100 flex-grow-0 flex-shrink-0">
                    <div class="w-100 open-codes-header" [hidden]="openedTabs.length===0">
                        @for(tab of openedTabs; track tab){
                            <div class="px-2 py-1 open-file-item"
                                 (click)="activeTab(tab)"
                                 (contextmenu)="onContextMenu($event, tab)"
                                 [class.active]="isActiveTab(tab)">
                                <img width="15" height="15" [src]="getIconPath(tab.name)" alt="文件图标">
                                <div>{{tab.name}}</div>
                                <button class="plane-button" (click)="closeTab(tab, $event)">
                                    <nz-icon nzType="close" />
                                </button>
                                @if(contextMenuVisible && (contextMenuTab?.type === tab.type || contextMenuTab?.file?.path===tab.file?.path) ){
                                    <div class="context-menu" [style.top.px]="contextMenuPosition.y" [style.left.px]="contextMenuPosition.x" (click)="$event.stopPropagation()">
                                        <div class="context-menu-item" (click)="closeTab(contextMenuTab, $event)">关闭</div>
                                        <div class="context-menu-item" (click)="closeOtherTab(contextMenuTab, $event)">关闭其他标签页</div>
                                        <div class="context-menu-item" (click)="closeAllTab($event)">关闭所有标签页</div>
                                    </div>
                                }
                            </div>
                        }
                    </div>
                    <div class="d-flex flex-grow-1">
                        @if(panelResizeControl){
                            @if(showFile){
                                <ngx-monaco-editor class="w-100 h-100" [options]="editorOptions" [(ngModel)]="content"></ngx-monaco-editor>

                            }@else{
                                <app-code-space-settings (settingsChange)="onSettingChange($event)" ></app-code-space-settings>
                            }
                        }
                    </div>
                </div>
            </as-split-area>
        </as-split>
    </div>
</div>
